
/*

  V O L U M E N T

  Analytics and A/B testing for the 21st century

  v0.50 (beta) -- Sat Mar 14 07:52:51 EET 2020

  - -

  https://volument.com

*/


window.volument=function(c){if(typeof c=="string"||c instanceof String)c={token:c};var t=window.volument;if(t.identify)return;var r=new u(c),i=new m,n=new l(r,i);t.identify=function(t){e(t);o("lead",{uid:t})};t.convertToLead=function(){o("lead")};t.invite=function(t){e(t);o("promoter",{peer:t},true)};t.pay=function(t){o("customer",{am:t},true)};t.convertToCustomer=t.pay;t.visitor=i;t.route=function(t){n.set(t||location.pathname)};window.addEventListener("beforeunload",n.unload);if(!c.spa)t.route();t.toString=function(){return"Conversion optimization for the 21st century"};function e(t){var n="Volument userId: ";if(!t)throw n+"required";if(/.+\@.+\..+/.test(t))throw n+"cannot be an email address"}function o(t,n,e){if(e||!i["is_"+t]){n.c=t;r.send(n);i.convert(t)}}function u(r){var i=r.host||"https://t1.volument.com/beta",o=a("%cid"),u=r.disabled||o===null,f=r.token;if(!o&&!u)o=a("%cid",d());if(h(navigator.userAgent)||f.indexOf("token")>=0)u=true;this.send=function(t){if(u)return;var n=i+"?"+s({t:f,cid:escape(o)})+"&"+s(t),e=new Image;r.debug?console.info(t):e.src=n;e.onerror=function(){u=true}}}function a(t,n){try{return n?localStorage[t]=n:localStorage[t]}catch(t){return null}}function s(e){var r="";Object.keys(e||{}).forEach(function(t){var n=e[t];if(n)r+=t+"="+n+"&"});return r.slice(0,-1)}function d(){var t="abcdefghijklmnopqrstuvwxyz",n=t+t.toUpperCase()+"0123456789!#%&+?:;,*.$@][|<>_-^()/";var e="";for(var r=0;r<6;r++){e+=n.charAt(Math.floor(Math.random()*n.length))}return e}function h(t){var n="bot bingpreview mediapartners slurp baiduspider sogou facebook ia_archiver".split(" ");t=t.toLowerCase();for(var e=0;e<n.length;e++){if(t.indexOf(n[e])>=0)return true}}function v(t){var n=4800,e,r,i,o;function u(){t(f(),i/10,o);i=0}this.trigger=u;this.reset=function(){r=e=Date.now();o=i=0};setInterval(function(){o++;if(document.hidden)return;if(Date.now()-r>n)return;i++;if([10,25,40].indexOf(o)>=0||Date.now()-e>2900){e=Date.now();u()}},100);["mousemove","keyup","scroll"].forEach(function(t){document.addEventListener(t,function(){r=Date.now()})});this.reset()}function f(){var t=window.pageYOffset||document.body.scrollTop,n=document.body.scrollHeight,e=screen.height,r=Math.min(Math.round(n/e),4),i=n/r;for(var o=0;o<r;o++){if(t+e/2<i*o+e)return o}return o}function l(e,r){var i,t,o=0;var u=new v(function(t,n){i&&e.send({ref:r.getInfo().ref,p:s(i),vp:t+"+"+n,i:++o})});this.set=function(t){t=t.split(/[?#]/)[0];if(t!=i){i=t;u.reset();var n=f(r.getInfo(),{p:s(t),xy:a()});e.send(n)}};this.unload=function(){};function f(n,e){Object.keys(e).forEach(function(t){n[t]=e[t]});return n}function a(){var t=document.body;return(screen.width||window.innerWidth||t.clientWidth)+"x"+(screen.height||window.innerHeight||t.clientHeight)}function s(t){var n=c.shorten;if(n){if(typeof n=="string")n=c.shorten.split(" ");for(var e=0;e<n.length;e++){var r=t.split(n[e]);if(r[1])return n[e]}}return t}}function m(){var n=a("%v"),e=Math.round(Date.now()/3600/1e3);if(n){n=JSON.parse(n);var t=e-n.l;if(t){n.l=e;n.v++}}else{n={f:e,l:e,v:1,ref:w()}}var r=this.is_new=n.f==n.l;this.visits=n.v;this.hours=e-n.f;this.referrer=n.ref;this.first_visit=new Date(n.f*3600*1e3);this.days=Math.round(this.hours/24);for(var i in n){if(i[0]=="!"){this["is_"+i.slice(1)]=true;this.is_converted=true}}function o(){a("%v",JSON.stringify(n))}this.convert=function(t){n["!"+t]=e-n.f;this["is_"+t]=true;o()};this.getInfo=function(){return{mob:"ontouchstart"in document.documentElement?1:0,old:r&&p(),tm:y(),ref:w(),h:this.hours}};o()}function p(){var t=g("gid")||g("ga");if(t){var n=1*t.split(".")[3],e=Date.now()/1e3-n;if(e>60)return Math.round(n)}}function w(){var t=document.referrer;if(!t.split(location.hostname)[1]){return t.split("/")[2]}}function g(t){var n=document.cookie,e=n.indexOf(t+"=");return e>=0&&n.slice(e+4,n.indexOf(";",e))}function y(){var t=location.search.slice(1).split("&");for(var n=0;n<t.length;n++){var e=t[n];if(/^m\d+$/.test(e))return e}}};
